!function(e){e.waterfall=function(){var t=[],n=e.Deferred(),r=0;return e.each(arguments,(function(s,a){t.push((function(){var s,l=[].slice.apply(arguments);"function"==typeof a?(s=a.apply(null,l))&&s.promise||(s=e.Deferred()[!1===s?"reject":"resolve"](s)):s=a&&a.promise?a:e.Deferred()[!1===a?"reject":"resolve"](a),s.fail((function(){n.reject.apply(n,[].slice.apply(arguments))})).done((function(e){r++,l.push(e),r==t.length?n.resolve.apply(n,l):t[r].apply(null,l)}))}))})),t.length?t[0]():n.resolve(),n}}(jQuery),function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,(function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function s(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function a(e,t){return null!=e&&"object"==typeof e&&t in e}var l=RegExp.prototype.test;var o=/\S/;function i(e){return!function(e,t){return l.call(e,t)}(o,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var u=/\s*/,p=/\s+/,d=/\s*=/,f=/\s*\}/,h=/#|\^|\/|>|\{|&|=|!/;function m(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function I(){this.cache={}}m.prototype.eos=function(){return""===this.tail},m.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},m.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var s,l,o=this,i=!1;o;){if(e.indexOf(".")>0)for(t=o.view,s=e.split("."),l=0;null!=t&&l<s.length;)l===s.length-1&&(i=a(t,s[l])),t=t[s[l++]];else t=o.view[e],i=a(o.view,e);if(i)break;o=o.parent}n[e]=t}return r(t)&&(t=t.call(this.view)),t},I.prototype.clearCache=function(){this.cache={}},I.prototype.parse=function(t,r){var a=this.cache,l=a[t];return null==l&&(l=a[t]=function(t,r){if(!t)return[];var a,l,o,c=[],g=[],I=[],v=!1,b=!1;function y(){if(v&&!b)for(;I.length;)delete g[I.pop()];else I=[];v=!1,b=!1}function $(e){if("string"==typeof e&&(e=e.split(p,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);a=new RegExp(s(e[0])+"\\s*"),l=new RegExp("\\s*"+s(e[1])),o=new RegExp("\\s*"+s("}"+e[1]))}$(r||e.tags);for(var w,S,C,k,x,q,R=new m(t);!R.eos();){if(w=R.pos,C=R.scanUntil(a))for(var M=0,T=C.length;M<T;++M)i(k=C.charAt(M))?I.push(g.length):b=!0,g.push(["text",k,w,w+1]),w+=1,"\n"===k&&y();if(!R.scan(a))break;if(v=!0,S=R.scan(h)||"name",R.scan(u),"="===S?(C=R.scanUntil(d),R.scan(d),R.scanUntil(l)):"{"===S?(C=R.scanUntil(o),R.scan(f),R.scanUntil(l),S="&"):C=R.scanUntil(l),!R.scan(l))throw new Error("Unclosed tag at "+R.pos);if(x=[S,C,w,R.pos],g.push(x),"#"===S||"^"===S)c.push(x);else if("/"===S){if(!(q=c.pop()))throw new Error('Unopened section "'+C+'" at '+w);if(q[1]!==C)throw new Error('Unclosed section "'+q[1]+'" at '+w)}else"name"===S||"{"===S||"&"===S?b=!0:"="===S&&$(C)}if(q=c.pop())throw new Error('Unclosed section "'+q[1]+'" at '+R.pos);return function(e){for(var t,n=[],r=n,s=[],a=0,l=e.length;a<l;++a)switch((t=e[a])[0]){case"#":case"^":r.push(t),s.push(t),r=t[4]=[];break;case"/":s.pop()[5]=t[2],r=s.length>0?s[s.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],s=0,a=e.length;s<a;++s)(t=e[s])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(g))}(t,r)),l},I.prototype.render=function(e,t,n){var r=this.parse(e),s=t instanceof g?t:new g(t);return this.renderTokens(r,s,n,e)},I.prototype.renderTokens=function(e,t,n,r){for(var s,a,l,o="",i=0,c=e.length;i<c;++i)l=void 0,"#"===(a=(s=e[i])[0])?l=this.renderSection(s,t,n,r):"^"===a?l=this.renderInverted(s,t,n,r):">"===a?l=this.renderPartial(s,t,n,r):"&"===a?l=this.unescapedValue(s,t):"name"===a?l=this.escapedValue(s,t):"text"===a&&(l=this.rawValue(s)),void 0!==l&&(o+=l);return o},I.prototype.renderSection=function(e,t,s,a){var l=this,o="",i=t.lookup(e[1]);if(i){if(n(i))for(var c=0,u=i.length;c<u;++c)o+=this.renderTokens(e[4],t.push(i[c]),s,a);else if("object"==typeof i||"string"==typeof i||"number"==typeof i)o+=this.renderTokens(e[4],t.push(i),s,a);else if(r(i)){if("string"!=typeof a)throw new Error("Cannot use higher-order sections without the original template");null!=(i=i.call(t.view,a.slice(e[3],e[5]),(function(e){return l.render(e,t,s)})))&&(o+=i)}else o+=this.renderTokens(e[4],t,s,a);return o}},I.prototype.renderInverted=function(e,t,r,s){var a=t.lookup(e[1]);if(!a||n(a)&&0===a.length)return this.renderTokens(e[4],t,r,s)},I.prototype.renderPartial=function(e,t,n){if(n){var s=r(n)?n(e[1]):n[e[1]];return null!=s?this.renderTokens(this.parse(s),t,n,s):void 0}},I.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},I.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},I.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var v=new I;return e.clearCache=function(){return v.clearCache()},e.parse=function(e,t){return v.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+((n(s=e)?"array":typeof s)+'" was given as the first argument for mustache#render(template, view, partials)'));var s;return v.render(e,t,r)},e.to_html=function(t,n,s,a){var l=e.render(t,n,s);if(!r(a))return l;a(l)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=m,e.Context=g,e.Writer=I,e}));var Installer={currentStep:null,options:{page:"#page",form:"#setup-form",currentStepSelector:"#current-step",submitButton:'button[type="submit"]',progressBox:"#progress-box",flashMessageSelector:"#flash-message"},Steps:{start:{handler:"onLoadLicence"},license:{handler:"onCompleteRequirements"},requirements:{handler:"onCheckRequirements"},database:{handler:"onCheckDatabase"},settings:{handler:"onValidateSettings"},install:{dataCache:{},handler:"onInstall",steps:{download:{msg:"Downloading {{name}} {{type}}...",error:"Downloading {{name}} {{type}} failed. See setup log."},extract:{msg:"Extracting {{name}} {{type}}...",error:"Extracting {{name}} {{type}} failed. See setup log."},config:{msg:"Writing site configuration files...",error:"Writing site configuration files failed. See setup log."},install:{msg:"Finishing site setup...",error:"Finishing site setup failed. See setup log."}}},proceed:{proceedUrl:"/admin/settings",frontUrl:"/"},success:{}},init:function(){Installer.$page=$(Installer.options.page),Installer.$pageContent=Installer.$page.find('[data-html="content"]'),Installer.$pageModal=Installer.$page.find('[data-html="modal"]'),Installer.$progressBox=$(Installer.options.progressBox),Installer.currentStep=$(Installer.options.currentStepSelector).val(),Installer.$form=$(Installer.options.form),Installer.updateWizard(Installer.currentStep),Installer.renderView(Installer.currentStep),$(document).ready((function(){Installer.$submitBtn=$(Installer.options.submitButton),Installer.$form.submit(Installer.submitForm),Installer.$page.on("click","[data-install-control]",Installer.onControlClick),Installer.$pageModal.on("hidden.bs.modal",Installer.onModalHidden)}))},submitForm:function(e){e.preventDefault(),Installer.$submitBtn.hasClass("disabled")||(Installer.currentStep=$(Installer.options.currentStepSelector).val(),Installer.processForm())},onControlClick:function(e){var t=$(e.currentTarget),n=t.data("installControl");switch(n){case"retry-check":Installer.checkRetry();break;case"load-license":Installer.processResponse({step:"license"});break;case"accept-license":Installer.processResponse({step:"requirements"});break;case"complete-requirements":Installer.sendRequest("onCompleteRequirements",{}).done((function(e){Installer.processResponse(e)}));break;case"install-fresh":case"install-prebuilt":Installer.processInstall(t,n)}},onModalHidden:function(e){$(e.currentTarget).find(".modal-dialog").remove()},disableSubmitButton:function(e){Installer.$submitBtn&&Installer.$submitBtn.length&&(Installer.$submitBtn.prop("disabled",e),e?Installer.$submitBtn.addClass("disabled"):Installer.$submitBtn.removeClass("disabled"))},getHandler:function(e){return Installer.Steps[e].handler},processForm:function(){if(Installer.$form.length){var e=Installer.getAlert(Installer.currentStep),t=Installer.getHandler(Installer.currentStep);Installer.sendRequest(t,{},e).done((function(e){Installer.processResponse(e)}))}},sendRequest:function(e,t,n){t.handler=e;var r=void 0!==Installer.$form?Installer.$form.serialize()+(void 0===t?"":"&"+$.param(t)):[];return Installer.disableSubmitButton(!0),$.ajax({async:!0,type:"POST",cache:!0,data:r}).done((function(){Installer.disableSubmitButton(!1)})).fail((function(e){Installer.disableSubmitButton(!1),Installer.flashMessage("danger",e.responseText)}))},getAlert:function(e){if(Installer.Steps.hasOwnProperty(e))return Installer.Steps[e].msg},checkRetry:function(){Installer.checkRequirements()},updateWizard:function(e){$(Installer.options.currentStepSelector).val(e),$("body").attr("class",e),Installer.currentStep=e},checkRequirements:function(){var e=Installer.$page.find("[data-requirement]"),t=$("#requirement-check-result").empty(),n=$('[data-partial="_alert_check_failed"]').clone().html(),r=$('[data-partial="_alert_check_complete"]').clone().html(),s=Installer.Steps.requirements.handler,a=[],l=[],o=[],i=!0;$.each(e,(function(e,t){var n=$(t),r=n.data();a.push((function(){var e=$.Deferred(),t=n.find('[role="status"]');return n.addClass("pulse"),n.find("[data-label]").removeClass("text-muted"),n.find("[data-spinner]").removeClass("fas fa-circle text-muted").addClass("spinner-grow spinner-grow-sm"),Installer.sendRequest(s,{code:r.requirement}).done((function(s){setTimeout((function(){s.result?(n.addClass("done"),t.addClass("fas fa-circle text-success").removeClass("spinner-grow"),e.resolve()):(i=!1,n.addClass("failed"),t.addClass("fas fa-circle text-danger").removeClass("spinner-grow"),t.attr("title",r.hint),l.push(r.requirement),o.push(r.hint),e.resolve()),e.resolve()}),1500)})).fail((function(){setTimeout((function(){i=!1,l.push(r.requirement),o.push(r.hint),n.addClass("failed"),t.attr("title",r.hint),e.resolve()}),1500)})),e}))})),$.waterfall.apply(this,a).always((function(){})).done((function(e){i?(Installer.$form.append('<input type="hidden" name="requirement" value="complete">'),t.append(Mustache.render(r)),t.show().addClass("animated fadeIn")):(t.append(Mustache.render(n,{code:l.join(", "),message:o.join("<br> ")})),t.show().addClass("animated fadeIn"))}))},processInstallSteps:function(e){var t=!0,n=[],r=[],s=null,a=Installer.$pageContent.find(".install-progress .message");$.each(e,(function(e,l){var o=Installer.Steps.install.steps[e];$.each(l,(function(l,i){n.push((function(){var n,l=$.Deferred(),c=Mustache.render(o.msg,i);return n={process:i.process,disableLog:!0,item:i},a.text(c),Installer.sendRequest("onInstall",n,c).done((function(n){setTimeout((function(){if(n.result)"install"===e&&(s=n.result),l.resolve();else{t=!1;var c=Mustache.render(o.error,i);a.text(c),r.push(c),l.resolve()}l.resolve()}),500)})).fail((function(){setTimeout((function(){t=!1,l.resolve()}),500)})),l}))}))})),$.waterfall.apply(this,n).done((function(){t?(Installer.updateWizard("proceed"),Installer.renderView("proceed",{proceedUrl:s||"/admin/login",frontUrl:"/"})):(Installer.$pageContent.html($('[data-partial="_alert__alert_install_failed"]').html()),$(".install_failed .message").text(r.join("<br />")))}))},renderView:function(e,t){var n=Installer.Steps[e],r=n.view;if(n||(n={}),e){var s=Mustache.render($(r).html(),$.extend(n,t,{}));Installer.$pageContent.html(s)}"requirements"===Installer.currentStep&&Installer.checkRequirements(),Installer.$pageModal.modal("hide")},flashMessage:function(e,t){if(t){var n=$(Installer.options.flashMessageSelector),r=$("<div />",{class:"animated bounceIn shadow alert alert-"+e+" alert-dismissible"});n.empty(),n.addClass("show"),r.append(t),r.append('<button type="button" class="btn-close" data-bs-dismiss="alert" aria-hidden="true"></button>'),n.append(r),"danger"!==e&&r.delay(5e3).fadeOut(400,(function(){$(this).remove()}))}},processResponse:function(e){var t=e.flash,n=e.modal,r=e.step;if(t&&Installer.flashMessage(t.type,t.message),n){var s=$('[data-partial="'+n+'"]').clone().html();Installer.$pageModal.html(Mustache.render(s)),Installer.$pageModal.modal()}switch(r){case"license":case"requirements":case"database":case"settings":case"install":Installer.updateWizard(r),Installer.renderView(r)}},processInstall:function(e,t){var n={themeCode:e.data("themeCode"),process:"apply",disableLog:!0};e.attr("disabled",!0),Installer.$pageContent.html($('[data-partial="_alert_install_progress"]').html()),Installer.sendRequest("onInstall",n).done((function(e){Installer.processInstallSteps(e.result)})).fail((function(){Installer.$pageContent.html($('[data-partial="install"]').html())})).always((function(){e.attr("disabled",!1)}))}};
